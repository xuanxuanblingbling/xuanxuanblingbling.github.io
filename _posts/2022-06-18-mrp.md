---
title: 考古：重现MRP游戏开发环境
categories:
- CTF/Game
tags: 
---

> 更新中...在网上找到[斯凯SDK开发包(含向导).rar](https://download.csdn.net/download/weixin_43726540/11856510)

经过使用，简化附件为[Mrp开发包.zip](https://xuanxuanblingbling.github.io/assets/attachment/mrp/Mrp开发包.zip)，其中包括的文件有：

- 使用说明.txt
- ADS1.2的授权文件/license.dat
- SKY Developer Suite(CP)_Setup.exe
- SDK破解/使用说明.txt
- SDK破解/mr_helpere.mrp
- SDK破解/mr_helperk.mrp
- SDK破解/mr_helpero.mrp
- SDK破解/SDKCrack.exe

## 基础环境

首先安一个XP虚拟机和Visual Studio 2005：

> [https://msdn.itellyou.cn/](https://msdn.itellyou.cn/)

- XP SP2：[ed2k://|file|sc_winxp_pro_with_sp2.iso|629227520|505B810E128351482AF8B83AC4D04FD2|/](ed2k://|file|sc_winxp_pro_with_sp2.iso|629227520|505B810E128351482AF8B83AC4D04FD2|/)，网上找了一个windows xp sp2的秘钥：BB96V-433XK-GM9WR-KXCDJ-4HTQW
- VS 2005：[ed2k://|file|cs_vs_2005_pro_dvd.iso|2733268992|9DA1C378BAC22E66A73C9E20EC78CCFB|/](ed2k://|file|cs_vs_2005_pro_dvd.iso|2733268992|9DA1C378BAC22E66A73C9E20EC78CCFB|/)，原版XP不自带能打开iso的软件，可以在外面解压好在拖进去，安装程序为./vs/setup.exe，自定义安装，语言仅勾选Visual C++即可

![image](https://xuanxuanblingbling.github.io/assets/pic/mrp/vscode.png)

## ARM Developer Suite

这就是个windows下的ARM交叉编译环境，找到官方的ARM Developer Suite，大小88.24MB，但是安装过程提示需要下一张CD...

- [https://developer.arm.com/downloads/-/rvds-and-ads](https://developer.arm.com/downloads/-/rvds-and-ads)
- [ADS 1.2/ADS1.2_windows_installation.zip](https://developer.arm.com/-/media/Files/downloads/Legacy/ADS/ADS%201.2/ADS1.2_windows_installation.zip?revision=0ac5aa01-aa83-47a3-96bf-f9deaa10bb75)

后在网上在找到118M的版本，可以正常安装：

- [ARM Developer Suite(ARM开发工具套装) v1.2 官方安装版(附安装教程)](https://www.jb51.net/softs/543359.html)

运行Setup.exe，这个安装时选择typical（是默认的）就行了，需要输入license，给入附件中的**ADS1.2的授权文件/license.dat**文件即可。

## SKY Developer Suite

安装附件中的SKY Developer Suite(CP)_Setup.exe，即斯凯MRP的SDK，默然安装路径为`C:\SKYMOBI\`，这个SDK可以找到系统中的VS 2005并添加工程模板。但这曾经是一个需要授权的SDK，所以目前运行需要破解，复制附件中的以下四个文件到`C:\SKYMOBI\SDS4CPv1.0\Compiler`目录中：

- mr_helpere.mrp
- mr_helperk.mrp
- mr_helpero.mrp
- SDKCrack.exe

然后在复制后的目录运行SDKCrack.exe，提示破解成功。

## 新建工程以及编译

最后打开VS2005，新建工程，选择C++，即可看到斯凯的开发扩展，找到并选择SkyAppWiz(CP)1

![image](https://xuanxuanblingbling.github.io/assets/pic/mrp/sky.png)

具体工程类别为：

- Helloworld工程：Helloworld
- DEMO工程：空战游戏的模版
- SGL应用程序：开发一些实用功能的软件的模版

例如我使用Helloworld工程，修改DemoWinWinEvent函数，打印个内存地址：

```c
void DemoWinWinEvent(int32 data, int32 eventId)
{
	char buf[20];

	switch (eventId)
	{
	case WIN_EVENT_SHOW:
	case WIN_EVENT_REFRESH:	
		mrc_clearScreen(255, 255, 255);
		
		sprintf(buf,"[+] XUANXUAN %x",(void *)buf);
		mrc_drawText(buf, 0, 152, 0, 0, 0, 0, MR_FONT_MEDIUM);
		
		mrc_refreshScreen(0, 0, 240, 320);
		break;
	case WIN_EVENT_PAUSE:
		break;
	case WIN_EVENT_EXIT:
		break;
	case WIN_EVENT_UPDATE:
		break;
	}
}
```

如果想编译成mrp，必须找到你新建工程的那个文件夹，然后运行build.bat生成，此脚本具体内容如下，只是调用mrpbuilder.exe，生成的mrp在bin文件夹。

```c
C:\SKYMOBI\SDS4CPv1.0\Compiler\mrpbuilder.exe ./Makefile.mpr
pause
```

如果想在支持mrp的实机运行，可在sd卡根目录下新建mythroad目录，并将编译好的Helloworld_240.mrp改名为dsm_gm.mrp放入其中，然后开机输入`*#220807#`即可

![image](https://xuanxuanblingbling.github.io/assets/pic/mrp/final.jpeg)

给出编译后的mrp文件：[Helloworld_240.mrp](https://xuanxuanblingbling.github.io/assets/attachment/mrp/Helloworld_240.mrp)，至此可以继续探索mrp游戏背后的实现秘密了。



